<?xml version="1.0"?>
<mx:Panel xmlns:fx="http://ns.adobe.com/mxml/2009"
          xmlns:mx="library://ns.adobe.com/flex/mx"
          title="设置扫描运行"
          width="95%"
          height="95%"
          layout="vertical"
          horizontalAlign="center"
          verticalAlign="top" creationComplete="init()">

    <mx:Form width="100%" verticalGap="20">
        <mx:FormItem label="UPC/GTIN:" fontSize="20" fontWeight="bold">
            <mx:TextInput id="gtinText" minWidth="300" keyDown="gtinText_keyDownHandler(event)"></mx:TextInput>
        </mx:FormItem>
        <mx:FormItem label="商品:" fontSize="20" fontWeight="bold">
            <mx:Text id="productLabel" text="{Application.application.product.title}"></mx:Text>
        </mx:FormItem>
        <mx:FormItem label="货柜:" fontSize="20" fontWeight="bold">
            <mx:ComboBox id="productBox" minWidth="300"
                         change="productBox_changeHandler(event)"
                         dataProvider="{Application.application.product.productContainerConfigs}"
                         labelFunction="productBoxLabelFun"></mx:ComboBox>
        </mx:FormItem>
        <mx:FormItem label="批次编号:" fontSize="20" fontWeight="bold">
            <mx:TextInput id="manufacturerLotText" minWidth="300"
                          text="@{Application.application.manufacturerLot}"></mx:TextInput>
        </mx:FormItem>
        <mx:FormItem label="总单位数:" fontSize="20" fontWeight="bold">
            <mx:TextInput id="expectedCountText" minWidth="300"
                          text="@{Application.application.expectedCount}"></mx:TextInput>
        </mx:FormItem>
        <mx:FormItem label="备注:" fontSize="20" fontWeight="bold">
            <mx:TextInput id="manufacturerReferenceText" minWidth="300"
                          text="@{Application.application.manufacturerReference}"></mx:TextInput>
        </mx:FormItem>
    </mx:Form>
    <mx:Button label="创建" width="100" height="60" fontWeight="bold" fontSize="25" click="createRun()"></mx:Button>

    <fx:Script><![CDATA[
        import mx.core.Application;
        import mx.events.ListEvent;
        import mx.rpc.events.ResultEvent;

        private function init():void {
            gtinText.setFocus();
        }

        private function gtinText_keyDownHandler(event:KeyboardEvent):void {
            if (!gtinText.text) {
                return;
            }
            if (event.keyCode == Keyboard.ENTER) {
                RemoteObjectUtils.execute("amazonService", "getProductlist", function (data:ResultEvent) {
                    Application.application.product = data.result;
                    Application.application.productBoxItem = data.result.productContainerConfigs[0];
                }, Application.application.cookie, gtinText.text);
            }
        }

        private function productBoxLabelFun(item:Object):String {
            var result = '[' + item.unitStringId + '-' + item.caseStringId + ']';
            result += ' UPC/GTIN(' + item.gtin + ')';
            result += ' 包装(' + item.parentGtin + ')';
            result += ' 号段(' + item.unitLabelRegExPattern + ')';
            result += ' 每箱数量(' + item.unitsPerCase + ')';
            return result;
        }

        private function createRun():void {
            if (!manufacturerLotText.text) {
                return;
            }
            if (!expectedCountText.text) {
                return;
            }
            if (!manufacturerReferenceText.text) {
                return;
            }


            RemoteObjectUtils.execute("amazonService", "scanRun", function (data:ResultEvent) {
                        Application.application.currentState = 'scanItems';
                    },
                    Application.application.cookie,
                    productBox.selectedItem,
                    manufacturerLotText.text,
                    expectedCountText.text,
                    0,
                    manufacturerReferenceText.text);


        }

        private function productBox_changeHandler(event:ListEvent):void {
            Application.application.productBoxItem = productBox.selectedItem;
        }
        ]]></fx:Script>
</mx:Panel>
