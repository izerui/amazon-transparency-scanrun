<?xml version="1.0"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:mx="library://ns.adobe.com/flex/mx"
               xmlns:s="library://ns.adobe.com/flex/spark" xmlns:local="*"
               currentState="product"
               creationComplete="validateCookie()">

    <s:layout>
        <s:VerticalLayout horizontalAlign="center" verticalAlign="middle"/>
    </s:layout>

    <fx:Style>
        global {
            fontSize: 16px;
        }
    </fx:Style>

    <fx:Script><![CDATA[
        import mx.managers.PopUpManager;

        import vo.ProductContainerConfigs;

        //        private var keepTimer:Timer;

        [Bindable]
        public var cookie:String;
        [Bindable]
        public var product:vo.Product;
        [Bindable]
        public var productBoxItem:ProductContainerConfigs;
        [Bindable]
        public var manufacturerLot:String;
        [Bindable]
        public var expectedCount:String;
        [Bindable]
        public var manufacturerReference:String;

        public function validateCookie():void {
            if (!cookie) {
                var login:Login = new Login();
                PopUpManager.addPopUp(login, this, true);
                PopUpManager.centerPopUp(login);
            }
        }

        //        private function keepCookie():void {
        //            if (keepTimer == null) {
        //                keepTimer = new Timer(5000, 0);
        //                keepTimer.addEventListener(TimerEvent.TIMER, function (event:TimerEvent):void {
        //                    RemoteObjectUtils.execute("amazonService", "validateLoginStatus", function (data:ResultEvent) {
        //                        if (!data.result) {
        //                            cookie = null;
        //                            validateCookie();
        //                        }
        //                    }, cookie);
        //                });
        //            }
        //            keepTimer.start();
        //        }

        //        private function destroyKeeper():void {
        //            keepTimer.stop();
        //        }
        ]]>
    </fx:Script>

    <mx:Panel title="SourceMark v2"
              width="100%"
              height="100%"
              horizontalAlign="center"
              verticalAlign="middle">

        <local:Product includeIn="product"></local:Product>
        <local:ScanItems includeIn="scanItems"></local:ScanItems>

    </mx:Panel>

    <s:states>
        <mx:State name="product"></mx:State>
        <mx:State name="scanItems"></mx:State>
    </s:states>

</s:Application>
